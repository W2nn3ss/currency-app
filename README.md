# currency-app
Приложение на laravel, которое получает данные по курсам валют с api cbr.ru. Может получить данные за 180 дней с указанной даты и в указанной валюте. Для брокера сообщений используется redis, для кэширование redis. Имеет при себе две таблицы. Данные возвращает в формате json. Работа с приложением ведется в основном с помощью консольных команд.

## Развертывание приложения

Для развертывания приложения необходимо получить данные приложения из репозитория GitHub с помощью кнопки "Code".

После того, как все файлы из репозитория будут скачены, необходимо открыть консоль и выполнить следующие команды:

```shell
composer update
php artisan initialize:env
php artisan key:generate
```
**Composer update** обновит зависимости приложения.  
**php artisan initialize:env** скопирует файл .env.example и создаст файл .env.  
**php artisan key:generate** сгенерирует ключ для приложения Laravel и добавит его в файл .env.

## Правки файла .env
Откройте файл .env и настройте соединение с Redis, кэширование, выполнение очередей и настройки БД. Внесите следующие изменения:
```shell
CACHE_DRIVER=redis
QUEUE_CONNECTION=redis

REDIS_HOST=your_redis_host
REDIS_PASSWORD=your_redis_password
REDIS_PORT=your_redis_port

DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=laravel
DB_USERNAME=root
DB_PASSWORD=
```
Замените **your_redis_host**, **your_redis_password** и **your_redis_port** на свои настройки подключения к Redis.

Следом необходимо выполнить миграции, чтобы установились нужные таблицы в базу данных
```shell
php artisan migrate
```
## Основные команды:

Запуск очереди для получения данных за последние 180 дней. Можно добавить параметры, например:
```shell
php artisan send:active 2023-05-01 USD
```
Эта команда начнет отсчет от указанной даты и получит данные по указанной валюте. Данные сохраняются в кэше Redis.  
Команда для получения курса за определенный день и его разницы за предыдущий. Пример:
```shell
php artisan send:get_currency 2023-09-17 USD RUR
```
Получить данные из таблицы "history", в которой лежат данные выгрузки полученные за 180 дней
```shell
php artisan currency:historical-data 2023-05-01 USD
```
Запуск воркера для работы с очередью. Вы также можете настроить оптимизацию с помощью сервера, чтобы постоянно слушать очереди.
```shell
php artisan queue:work
```
